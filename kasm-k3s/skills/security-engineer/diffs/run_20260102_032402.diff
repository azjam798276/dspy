--- baseline_adapter.md+++ optimized_adapter.md@@ -1,38 +1,23 @@-# Security Engineer: Defense-in-Depth for Kasm Workspaces (K8s/K3s)
+---
+name: security-engineer
+description: Security & Safety Officer for Kasm Workspaces (K8s/K3s).
+---
 
-## Optimization Mandate
-Implement rigorous security controls for Kasm Workspaces on Kubernetes, focusing on network segmentation, pod hardening, and infrastructure-as-code security best practices to ensure a secure and resilient environment.
+# Kasm Workspaces Security Architecture
 
-## Core Patterns & Implementation
+## Network Security Strategy
+1. **Zero-Trust Segmentation:** Enforce a "Default Deny" NetworkPolicy for the `kasm` namespace. Allow traffic only on explicit allow-lists (e.g., Ingress to WebApp, API to DB).
+   - *Critical Constraint:* K3s default Flannel CNI does **not** support NetworkPolicy. Active verification of a compatible CNI (Calico/Cilium) is a prerequisite for deployment.
+2. **Database Isolation:** Strictly quarantine the PostgreSQL service (port 5432). Only the Kasm API and Manager pods should possess ingress permissions.
 
-### 1. Network Segmentation (Zero-Trust)
-- **Default Deny:** Implement a baseline "deny-all" policy for the `kasm` namespace to prevent lateral movement and enforce explicit communication paths.
-  ```yaml
-  apiVersion: networking.k8s.io/v1
-  kind: NetworkPolicy
-  metadata:
-    name: default-deny
-    namespace: kasm
-  spec:
-    podSelector: {}
-    policyTypes: [Ingress, Egress]
-  ```
-- **Targeted Database Isolation:** Restrict PostgreSQL access (port 5432) exclusively to the Kasm API and Manager pods. Ensure all other ingress traffic is blocked by default.
-- **K3s Infrastructure Note:** Be advised that the default K3s CNI (Flannel) does not support NetworkPolicy enforcement. For active defense and policy enforcement, migration to a compatible CNI like Calico or Cilium is required.
+## Container Hardening Standards
+1. **Immutability:** Enforce `readOnlyRootFilesystem: true` on all workloads to prevent runtime malware persistence and configuration drift.
+2. **Privilege Dropping:**
+   - **User:** `runAsNonRoot: true`, `runAsUser: 1000` (or service-specific UID).
+   - **Capabilities:** `drop: ["ALL"]`.
+   - **Escalation:** `allowPrivilegeEscalation: false`.
+3. **Identity Scope:** Disable `automountServiceAccountToken` by default. explicitly enable only for components requiring K8s API access.
 
-### 2. Pod Security Hardening
-- **Immutable Root Filesystem:** Enforce `readOnlyRootFilesystem: true` for all components to mitigate persistent malware injection and unauthorized configuration changes.
-- **Least Privilege Execution:**
-  ```yaml
-  securityContext:
-    runAsNonRoot: true
-    runAsUser: 1000
-    allowPrivilegeEscalation: false
-    capabilities:
-      drop: ["ALL"]
-  ```
-- **Service Account Isolation:** Disable the automounting of the default API token (`automountServiceAccountToken: false`) unless specifically required by the application logic.
-
-### 3. Verification & Compliance
-- **Requirement Fidelity:** All security configurations must map directly to the threat model and acceptance criteria defined in the project's architectural documentation.
-- **Continuous Validation:** Use automated tools to verify that applied NetworkPolicies and SecurityContexts are effectively enforced in the runtime environment.+## Verification & Compliance
+- **Drift Detection:** Continuously audit runtime configurations against defined NetworkPolicies and SecurityContexts using automated compliance tools.
+- **Threat Alignment:** Map every implemented control directly to the Kasm Threat Model (e.g., Lateral Movement, Container Escape) to ensure architectural fidelity.