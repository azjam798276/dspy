---
id: "rollout_20260101_084101_752239_golden"
generated_at: "2026-01-02T02:38:39.821277"
tags: ["security-engineer", "auto-generated"]
---

## Problem
---
id: "20260101_traefik_ingress_tls"
difficulty: "medium"
tags: ["networking", "ingress", "traefik", "tls", "k3s", "kasm"]
tech_stack: "K3s, Traefik, cert-manager, TLS, Ingress"
---

# User Story
As a network engineer, I want to configure Traefik ingress for Kasm Workspaces with automatic TLS certificate provisioning via cert-manager.

# Context & Constraints
Configure HTTPS access to Kasm via K3s Traefik:

**Components:**
- Traefik IngressRoute or Ingress resource
- TLS certificate (cert-manager or manual)
- HTTP to HTTPS redirect
- WebSocket support for session streaming

**Requirements:**
- Automatic TLS via Let's Encrypt (cert-manager)
- HTTP → HTTPS redirect middleware
- Valid certificate for kasm.example.com
- WebSocket upgrade headers preserved
- Sticky sessions for API

**Technic

## Solution
{
  "session_id": "8e8dfce2-6da2-45de-ae6a-93c703706c19",
  "response": "```json\n{\n  \"reasoning\": \"I have designed a Kubernetes manifest `manifests/kasm-ingress.yaml` to satisfy the networking requirements for Kasm Workspaces, adhering to the provided Golden Example and Story Constraints.\\n\\n1.  **ClusterIssuer**: Defines a `letsencrypt-prod` issuer using the HTTP-01 challenge. This is the standard method for `cert-manager` to automate TLS certificate provisioning on K3s.\\n2.  **Middleware**: Defines a `https-redirect` middleware in the `kasm` namespace. This meets the requirement for 'HTTP → HTTPS redirect middleware' and is referenced by the Ingress.\\n3.  **Ingress Configuration**:\\n    *   **Sticky Sessions**: Enabled via `affinity` and `sticky.cookie` annotations. This is identified as 'Critical' in the Golden Example for Kasm's multi-container architecture.\\n    *   **TLS Termination**: Configured with `router.tls: \\\"true\\\"` and the `cert-manager.io/cluster-issuer` annotation to automatically provision the `kasm-tls` secret.\\n    *   **Entrypoints**: Explicitly restricted to `websecure` (port 443) as per the Golden Example to ensure secure access. \\n    *   **Backend**: Routes to the `kasm-proxy` service on port 443, preserving the internal HTTPS communication expected by Kasm components.\",\n  \"code_changes\": [\n    {\n      \"file\": \"manifests/kasm-ingress.yaml\",\n      \"content\": \"apiVersion: cert-manager.io/v1\\nkind: ClusterIssuer\\nmetadata:\\n  name: letsencrypt-prod\\nspec:\\n  acme:\\n    server: https://acme-v02.api.letsencrypt.org/directory\\n    email: admin@example.com\\n    privateKeySecretRef:\\n      name: letsencrypt-prod\\n    solvers:\\n    - http01:\\n        ingress:\\n          class: traefik\\n---\\napiVersion: traefik.containo.us/v1alpha1\\nkind: Middleware\\nmetadata:\\n  name: https-redirect\\n  namespace: kasm\\nspec:\\n  redirectScheme:\\n    scheme: https\\n    permanent: true\\n---\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: kasm-ingress\\n  namespace: kasm\\n  annotations:\\n    kubernetes.io/ingress.class: traefik\\n    cert-manager.io/cluster-issuer: letsencrypt-prod\\n    traefik.ingress.kubernetes.io/router.entrypoints: websecure\\n    traefik.ingress.kubernetes.io/router.tls: \\\"true\\\"\\n    traefik.ingress.kubernetes.io/affinity: \\\"true\\\"\\n    traefik.ingress.kubernetes.io/service.sticky.cookie: \\\"true\\\"\\n    traefik.ingress.kubernetes.io/service.sticky.cookie.name: kasm_session\\n    traefik.ingress.kubernetes.io/router.middlewares: kasm-https-redirect@kubernetescrd\\n    traefik.ingress.kubernetes.io/service.server.port: \\\"443\\\"\\nspec:\\n  tls:\\n  - hosts:\\n    - kasm.example.com\\n    secretName: kasm-tls\\n  rules:\\n  - host: kasm.example.com\\n    http:\\n      paths:\\n      - path: /\\n        pathType: Prefix\\n        backend:\\n          service:\\n            name: kasm-proxy\\n            port:\\n              number: 4

## Key Techniques
- JWT token handling
- Middleware pattern
