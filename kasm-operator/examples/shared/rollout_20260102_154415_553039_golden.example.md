---
id: "rollout_20260102_154415_553039_golden"
generated_at: "2026-01-02T16:03:02.830504"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "ee505d45-c199-44ae-aeb2-906837e62afe",
  "response": "```json\n{\n  \"reasoning\": \"I have defined the `VDITemplate` CRD structure in `operator/api/v1alpha1/vditemplate_types.go` adhering to the cluster-scoped requirement and including all specified fields (Image, DisplayName, Description, Resources, Env). I utilized Kubebuilder markers to enforce validation (Required image) and set default values for resources (GPU: 1, Memory: 4Gi, CPU: 2). I also defined the necessary `VDITemplateSpec`, `VDITemplateStatus`, `ResourceSpec`, and `EnvVar` structs to map the schema defined in the TDD.\",\n  \"code_patch\": {\n    \"operator/api/v1alpha1/vditemplate_types.go\": \"/*\\nCopyright 2026 Kasm VDI Operator.\\n\\nLicensed under the Apache License, Version 2.0 (the \\\"License\\\");\\nyou may not use this file except in compliance with the License.\\nYou may obtain a copy of the License at\\n\\n    http://www.apache.org/licenses/LICENSE-2.0\\n\\nUnless required by applicable law or agreed to in writing, software\\ndistributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\nSee the License for the specific language governing permissions and\\nlimitations under the License.\\n*/\\n\\npackage v1alpha1\\n\\nimport (\\n\\tmetav1 \\\"k8s.io/apimachinery/pkg/apis/meta/v1\\\"\\n)\\n\\n// VDITemplateSpec defines the desired state of VDITemplate\\ntype VDITemplateSpec struct {\\n\\t// Image is the container image to use for the VDI session\\n\\t// +kubebuilder:validation:Required\\n\\tImage string `json:\\\"image\\\"`\\n\\n\\t// DisplayName is the human-readable name of the template\\n\\t// +optional\\n\\tDisplayName string `json:\\\"displayName,omitempty\\\"`\\n\\n\\t// Description explains what this template provides\\n\\t// +optional\\n\\tDescription string `json:\\\"description,omitempty\\\"`\\n\\n\\t// Resources defines the default compute resources for sessions using this template\\n\\t// +optional\\n\\tResources ResourceSpec `json:\\\"resources,omitempty\\\"`\\n\\n\\t// Env defines environment variables to inject into the session container\\n\\t// +optional\\n\\tEnv []EnvVar `json:\\\"env,omitempty\\\"`\\n}\\n\\n// ResourceSpec defines the default resource requests/limits\\ntype ResourceSpec struct {\\n\\t// DefaultGPU is the number of GPU slices to allocate. Defaults to 1.\\n\\t// +kubebuilder:default=1\\n\\t// +optional\\n\\tDefaultGPU int `json:\\\"defaultGPU,omitempty\\\"`\\n\\n\\t// DefaultMemory is the memory request/limit (e.g. \\\"4Gi\\\"). Defaults to \\\"4Gi\\\".\\n\\t// +kubebuilder:default=\\\"4Gi\\\"\\n\\t// +optional\\n\\tDefaultMemory string `json:\\\"defaultMemory,omitempty\\\"`\\n\\n\\t// DefaultCPU is the CPU request/limit (e.g. \\\"2\\\"). Defaults to \\\"2\\\".\\n\\t// +kubebuilder:default=\\\"2\\\"\\n\\t// +optional\\n\\tDefaultCPU string `json:\\\"defaultCPU,omitempty\\\"`\\n}\\n\\n// EnvVar represents a simple name-value pair for 

## Key Techniques
- JWT token handling
- Input validation
