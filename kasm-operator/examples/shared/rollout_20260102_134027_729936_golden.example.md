---
id: "rollout_20260102_134027_729936_golden"
generated_at: "2026-01-02T16:03:02.815319"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "1f4613c9-d7fa-4dd8-a220-3c1ef4c282b7",
  "response": "I have designed the `VDITemplate` CRD Go code to meet the user's requirements, including the `Cluster` scope, `Required` image field, and default resource values as specified in the TDD. I will now generate the JSON response containing the `operator/api/v1alpha1/vditemplate_types.go` file.\n\n```json\n{\n  \"reasoning\": \"I have implemented the `VDITemplate` CRD in Go using Kubebuilder markers to satisfy the acceptance criteria. \\n\\n1.  **Cluster Scope**: Added `//+kubebuilder:resource:scope=Cluster` to the `VDITemplate` struct, ensuring templates are available globally across namespaces.\\n2.  **Validation**: Marked the `Image` field as `//+kubebuilder:validation:Required` to enforce the mandatory container image.\\n3.  **Defaults**: Applied `//+kubebuilder:default` markers to `DefaultGPU`, `DefaultMemory`, and `DefaultCPU` fields in the `TemplateResourceSpec` struct, matching the TDD specifications (1 GPU, 4Gi RAM, 2 CPU).\\n4.  **Structure**: Defined `VDITemplateSpec`, `TemplateResourceSpec`, and `TemplateEnvVar` to strictly map to the TDD's JSON schema properties.\\n5.  **Printer Columns**: Added `+kubebuilder:printcolumn` markers to improve `kubectl get vditemplates` output visibility.\",\n  \"code_changes\": {\n    \"operator/api/v1alpha1/vditemplate_types.go\": \"package v1alpha1\\n\\nimport (\\n\\tmetav1 \\\"k8s.io/apimachinery/pkg/apis/meta/v1\\\"\\n)\\n\\n// VDITemplateSpec defines the desired state of VDITemplate\\ntype VDITemplateSpec struct {\\n\\t// Image is the container image for the VDI session\\n\\t// +kubebuilder:validation:Required\\n\\tImage string `json:\\\"image\\\"`\\n\\n\\t// DisplayName is the human-readable name of the template\\n\\t// +optional\\n\\tDisplayName string `json:\\\"displayName,omitempty\\\"`\\n\\n\\t// Description provides details about the template\\n\\t// +optional\\n\\tDescription string `json:\\\"description,omitempty\\\"`\\n\\n\\t// Resources defines the default resource allocations\\n\\t// +optional\\n\\tResources TemplateResourceSpec `json:\\\"resources,omitempty\\\"`\\n\\n\\t// Env defines environment variables for the session\\n\\t// +optional\\n\\tEnv []TemplateEnvVar `json:\\\"env,omitempty\\\"`\\n}\\n\\n// TemplateResourceSpec defines default resources\\ntype TemplateResourceSpec struct {\\n\\t// DefaultGPU is the number of GPUs to allocate\\n\\t// +kubebuilder:default=1\\n\\t// +optional\\n\\tDefaultGPU int `json:\\\"defaultGPU,omitempty\\\"`\\n\\n\\t// DefaultMemory is the amount of memory to allocate (e.g. \\\"4Gi\\\")\\n\\t// +kubebuilder:default=\\\"4Gi\\\"\\n\\t// +optional\\n\\tDefaultMemory string `json:\\\"defaultMemory,omitempty\\\"`\\n\\n\\t// DefaultCPU is the number of CPU cores to allocate (e.g. \\\"2\\\")\\n\\t// +kubebuilder:default=\\\"2\\\"\\n\\t// +optional\\n\\tDefaultCPU string `json:\\\"defaultCPU,omitempty\\\"`\\n}\\n\\n// TemplateEnvVar defines environment variables\\ntype TemplateEnvVar struct {

## Key Techniques
- JWT token handling
- Input validation
