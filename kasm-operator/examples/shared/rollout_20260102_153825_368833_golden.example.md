---
id: "rollout_20260102_153825_368833_golden"
generated_at: "2026-01-02T16:03:02.793693"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_rbac_security"
difficulty: "medium"
tags: ["security", "rbac", "kubernetes", "serviceaccount", "permissions"]
tech_stack: "Kubernetes RBAC, Go"
---

# User Story
As a security engineer, I want least-privilege RBAC for the VDI operator and users, so the platform follows security best practices.

# Context & Constraints
**Operator ServiceAccount:**
```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vdi-operator
  namespace: vdi-operator
```

**ClusterRole (Operator):**
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: vdi-operator
rules:
  - apiGroups: ["vdi.kasm.io"]
    resources: ["vdisessions", "vdisessions/status"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  - apiGroups: ["vdi.kasm.io"]
    

## Solution
{
  "session_id": "8572b7f4-38c8-496f-a71d-d659ebbac3b0",
  "response": "Based on the security context and the \"Least Privilege\" mandate, I have designed the RBAC permissions to strictly separate the Operator's infrastructure capabilities from the End-User's consumption capabilities. The Operator is granted `ClusterRole` access to manage the lifecycle of `VDISessions` and dependent resources (Pods, PVCs, IngressRoutes) but is explicitly denied access to `Secrets` to prevent credential leakage. The User is granted a namespace-scoped `Role` limited to `create`, `get`, `list`, and `delete` on `VDISessions`, preventing them from modifying running sessions (no `update`/`patch`) or executing commands in pods (no `pods/exec`). An Audit Policy is also provided to log these critical interactions.\n\n```json\n[\n  {\n    \"path\": \"manifests/rbac/operator-sa.yaml\",\n    \"content\": \"apiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: vdi-operator\\n  namespace: vdi-operator\\n\"\n  },\n  {\n    \"path\": \"manifests/rbac/operator-role.yaml\",\n    \"content\": \"apiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: vdi-operator\\nrules:\\n  # CRD Lifecycle Management\\n  - apiGroups: [\\\"vdi.kasm.io\\\"]\\n    resources: [\\\"vdisessions\\\", \\\"vdisessions/status\\\", \\\"vdisessions/finalizers\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\", \\\"create\\\", \\\"update\\\", \\\"patch\\\", \\\"delete\\\"]\\n  - apiGroups: [\\\"vdi.kasm.io\\\"]\\n    resources: [\\\"vditemplates\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\"]\\n  \\n  # Core Resource Management\\n  - apiGroups: [\\\"\\\"]\\n    resources: [\\\"pods\\\", \\\"services\\\", \\\"persistentvolumeclaims\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\", \\\"create\\\", \\\"update\\\", \\\"patch\\\", \\\"delete\\\"]\\n  - apiGroups: [\\\"\\\"]\\n    resources: [\\\"events\\\"]\\n    verbs: [\\\"create\\\", \\\"patch\\\"]\\n\\n  # Network Routing\\n  - apiGroups: [\\\"traefik.io\\\"]\\n    resources: [\\\"ingressroutes\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\", \\\"create\\\", \\\"update\\\", \\\"patch\\\", \\\"delete\\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: vdi-operator-binding\\nsubjects:\\n  - kind: ServiceAccount\\n    name: vdi-operator\\n    namespace: vdi-operator\\nroleRef:\\n  kind: ClusterRole\\n  name: vdi-operator\\n  apiGroup: rbac.authorization.k8s.io\\n\"\n  },\n  {\n    \"path\": \"manifests/rbac/user-role.yaml\",\n    \"content\": \"apiVersion: rbac.authorization.k8s.io/v1\\nkind: Role\\nmetadata:\\n  name: vdi-user\\n  namespace: vdi\\nrules:\\n  - apiGroups: [\\\"vdi.kasm.io\\\"]\\n    resources: [\\\"vdisessions\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"create\\\", \\\"delete\\\"]\\n    # Explicitly Denied: update, patch (prevents parameter tampering)\\n    # Explicitly Denied: pods/exec (prevents shell access)\\n

## Key Techniques
- JWT token handling
