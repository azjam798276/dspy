---
id: "rollout_20260102_154805_232241_golden"
generated_at: "2026-01-02T16:03:02.833208"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "ae0b381c-f823-4a64-a307-66ddaef6a81f",
  "response": "```json\n{\n  \"reasoning\": \"I will define the `VDITemplate` Custom Resource Definition (CRD) in `operator/api/v1alpha1/vditemplate_types.go`. This resource will be Cluster-scoped as requested, allowing templates to be shared across all namespaces. I will define the `VDITemplateSpec` with a required `Image` field and a `Resources` struct that includes default values for GPU (1), Memory (4Gi), and CPU (2) using Kubebuilder markers. This ensures that the platform has a structured way to define and validate desktop environments before `VDISession` resources consume them.\",\n  \"changes\": [\n    {\n      \"file\": \"operator/api/v1alpha1/vditemplate_types.go\",\n      \"content\": \"/*\\nCopyright 2026.\\n\\nLicensed under the Apache License, Version 2.0 (the \\\"License\\\");\\nyou may not use this file except in compliance with the License.\\nYou may obtain a copy of the License at\\n\\n    http://www.apache.org/licenses/LICENSE-2.0\\n\\nUnless required by applicable law or agreed to in writing, software\\ndistributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\nSee the License for the specific language governing permissions and\\nlimitations under the License.\\n*/\\n\\npackage v1alpha1\\n\\nimport (\\n\\tmetav1 \\\"k8s.io/apimachinery/pkg/apis/meta/v1\\\"\\n)\\n\\n// EnvVar defines environment variables for the session\\ntype EnvVar struct {\\n\\tName  string `json:\\\"name\\\"`\\n\\tValue string `json:\\\"value\\\"`\\n}\\n\\n// ResourceSpec defines the compute resources for the session\\ntype ResourceSpec struct {\\n\\t// +kubebuilder:default=1\\n\\tDefaultGPU int `json:\\\"defaultGPU,omitempty\\\"`\\n\\t// +kubebuilder:default=\\\"4Gi\\\"\\n\\tDefaultMemory string `json:\\\"defaultMemory,omitempty\\\"`\\n\\t// +kubebuilder:default=\\\"2\\\"\\n\\tDefaultCPU string `json:\\\"defaultCPU,omitempty\\\"`\\n}\\n\\n// VDITemplateSpec defines the desired state of VDITemplate\\ntype VDITemplateSpec struct {\\n\\t// Image is the container image for the desktop environment\\n\\t// +kubebuilder:validation:Required\\n\\tImage       string       `json:\\\"image\\\"`\\n\\tDisplayName string       `json:\\\"displayName,omitempty\\\"`\\n\\tDescription string       `json:\\\"description,omitempty\\\"`\\n\\tResources   ResourceSpec `json:\\\"resources,omitempty\\\"`\\n\\tEnv         []EnvVar     `json:\\\"env,omitempty\\\"`\\n}\\n\\n// VDITemplateStatus defines the observed state of VDITemplate\\ntype VDITemplateStatus struct {\\n}\\n\\n// +kubebuilder:object:root=true\\n// +kubebuilder:resource:scope=Cluster\\n\\n// VDITemplate is the Schema for the vditemplates API\\ntype VDITemplate struct {\\n\\tmetav1.TypeMeta   `json:\\\",inline\\\"`\\n\\tmetav1.ObjectMeta `json:\\\"metadata,omitempty\\\"`\\n\\n\\tSpec   VDITemplateSpec   `json:\\\"spec,omitempty\\\"`\\n\\tStatus VDITemplateStatus `json:\\\"s

## Key Techniques
- JWT token handling
- Input validation
