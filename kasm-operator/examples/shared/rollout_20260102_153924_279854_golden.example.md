---
id: "rollout_20260102_153924_279854_golden"
generated_at: "2026-01-02T16:03:02.801402"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_rbac_security"
difficulty: "medium"
tags: ["security", "rbac", "kubernetes", "serviceaccount", "permissions"]
tech_stack: "Kubernetes RBAC, Go"
---

# User Story
As a security engineer, I want least-privilege RBAC for the VDI operator and users, so the platform follows security best practices.

# Context & Constraints
**Operator ServiceAccount:**
```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vdi-operator
  namespace: vdi-operator
```

**ClusterRole (Operator):**
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: vdi-operator
rules:
  - apiGroups: ["vdi.kasm.io"]
    resources: ["vdisessions", "vdisessions/status"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  - apiGroups: ["vdi.kasm.io"]
    

## Solution
{
  "session_id": "86c87282-46ce-4993-977b-795bfacf9528",
  "response": "```json\n{\n  \"reasoning\": \"The security configuration requires establishing identities and permissions for both the VDI Operator and the end-users. \\n\\n1. **Operator Identity**: A `ServiceAccount` named `vdi-operator` is created in the `vdi-operator` namespace. This gives the controller a distinct identity separate from default accounts.\\n\\n2. **Operator Permissions**: A `ClusterRole` and `ClusterRoleBinding` are defined to grant the operator specific permissions across the cluster. The operator needs full control (`create`, `update`, `delete`, etc.) over its own Custom Resources (`vdisessions`, `vditemplates`) and the underlying resources it manages (`pods`, `services`, `persistentvolumeclaims`, `ingressroutes`). Critically, access to `secrets` is omitted to satisfy the 'No Secrets Access' constraint, and permissions are explicitly listed rather than using wildcards.\\n\\n3. **User Permissions**: A `Role` named `vdi-user` is created in the `vdi` namespace (where sessions live). Users are granted `create`, `delete`, `get`, and `list` permissions on `vdisessions`. Update/patch verbs are excluded to prevent users from modifying a running session's specification (e.g., changing the container image) after creation. Pod `exec` privileges are inherently absent as the role does not grant access to `pods/exec`.\\n\\n4. **Audit Logging**: An audit `Policy` is defined to log `RequestResponse` level events for the `vdi.kasm.io` API group. This ensures that every creation or deletion of a VDI session is fully logged for security auditing.\",\n  \"code_changes\": [\n    {\n      \"file\": \"manifests/rbac/operator-sa.yaml\",\n      \"content\": \"apiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: vdi-operator\\n  namespace: vdi-operator\\n\"\n    },\n    {\n      \"file\": \"manifests/rbac/operator-role.yaml\",\n      \"content\": \"apiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: vdi-operator\\nrules:\\n  - apiGroups: [\\\"vdi.kasm.io\\\"]\\n    resources: [\\\"vdisessions\\\", \\\"vdisessions/status\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\", \\\"create\\\", \\\"update\\\", \\\"patch\\\", \\\"delete\\\"]\\n  - apiGroups: [\\\"vdi.kasm.io\\\"]\\n    resources: [\\\"vditemplates\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\"]\\n  - apiGroups: [\\\"\\\"]\\n    resources: [\\\"pods\\\", \\\"services\\\", \\\"persistentvolumeclaims\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\", \\\"create\\\", \\\"update\\\", \\\"patch\\\", \\\"delete\\\"]\\n  - apiGroups: [\\\"traefik.io\\\"]\\n    resources: [\\\"ingressroutes\\\"]\\n    verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\", \\\"create\\\", \\\"update\\\", \\\"patch\\\", \\\"delete\\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: vdi-operator\\nsubjects:\\n  - kind: ServiceAccount\\n    name: vdi-

## Key Techniques
- JWT token handling
