---
id: "rollout_20260102_133357_823090_golden"
generated_at: "2026-01-02T16:03:02.827661"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "f82567c3-a55f-4675-863f-b7ddbb12883a",
  "response": "```json\n{\n  \"reasoning\": \"I have implemented the `VDITemplate` CRD Go struct in `operator/api/v1alpha1/vditemplate_types.go` according to the TDD specifications.\\n\\n1.  **Struct Definition**: Defined `VDITemplateSpec` with fields `Image`, `DisplayName`, `Description`, `Resources`, and `Env`.\\n2.  **Validation**: Added `+kubebuilder:validation:Required` to the `Image` field as it is mandatory.\\n3.  **Defaults**: Applied `+kubebuilder:default` markers to `DefaultGPU` (1), `DefaultMemory` (\\\"4Gi\\\"), and `DefaultCPU` (\\\"2\\\") within the `VDITemplateResources` struct.\\n4.  **Scope**: Used `+kubebuilder:resource:scope=Cluster` to define this as a cluster-wide resource, distinct from the namespaced `VDISession`.\\n5.  **Environment Variables**: Created a `TemplateEnvVar` helper struct to map the name/value pairs for environment variables.\",\n  \"code_changes\": {\n    \"operator/api/v1alpha1/vditemplate_types.go\": \"/*\\nCopyright 2026.\\n\\nLicensed under the Apache License, Version 2.0 (the \\\"License\\\");\\nyou may not use this file except in compliance with the License.\\nYou may obtain a copy of the License at\\n\\n    http://www.apache.org/licenses/LICENSE-2.0\\n\\nUnless required by applicable law or agreed to in writing, software\\ndistributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\nSee the License for the specific language governing permissions and\\nlimitations under the License.\\n*/\\n\\npackage v1alpha1\\n\\nimport (\\n\\tmetav1 \\\"k8s.io/apimachinery/pkg/apis/meta/v1\\\"\\n)\\n\\n// VDITemplateSpec defines the desired state of VDITemplate\\ntype VDITemplateSpec struct {\\n\\t// Image is the container image to use for the desktop session\\n\\t// +kubebuilder:validation:Required\\n\\tImage string `json:\\\"image\\\"`\\n\\n\\t// DisplayName is the human-readable name of the template\\n\\tDisplayName string `json:\\\"displayName,omitempty\\\"`\\n\\n\\t// Description provides details about the template\\n\\tDescription string `json:\\\"description,omitempty\\\"`\\n\\n\\t// Resources configuration for the session\\n\\tResources VDITemplateResources `json:\\\"resources,omitempty\\\"`\\n\\n\\t// Env variables to inject into the session\\n\\tEnv []TemplateEnvVar `json:\\\"env,omitempty\\\"`\\n}\\n\\n// VDITemplateResources defines resource requests/limits\\ntype VDITemplateResources struct {\\n\\t// DefaultGPU is the number of GPU slices to allocate\\n\\t// +kubebuilder:default=1\\n\\tDefaultGPU int `json:\\\"defaultGPU,omitempty\\\"`\\n\\n\\t// DefaultMemory is the memory request/limit\\n\\t// +kubebuilder:default=\\\"4Gi\\\"\\n\\tDefaultMemory string `json:\\\"defaultMemory,omitempty\\\"`\\n\\n\\t// DefaultCPU is the CPU request/limit\\n\\t// +kubebuilder:default=\\\"2\\\"\\n\\tDefaultCPU string `json:\\\"defaultCPU,omitempty\\\"`\\n}\\n\\n// TemplateEnvVar 

## Key Techniques
- JWT token handling
- Input validation
