---
id: "rollout_20260102_140211_579653_golden"
generated_at: "2026-01-02T16:03:02.825713"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_helm_chart"
difficulty: "hard"
tags: ["devops", "helm", "kubernetes", "deployment", "operator"]
tech_stack: "Helm 3, Kubernetes, Go"
---

# User Story
As a DevOps engineer, I want a Helm chart for the VDI Operator, so I can deploy and configure the platform with a single command.

# Context & Constraints
**Chart Structure:**
```
charts/vdi-operator/
├── Chart.yaml
├── values.yaml
├── templates/
│   ├── deployment.yaml
│   ├── rbac.yaml
│   ├── crds/
│   │   ├── vdisession-crd.yaml
│   │   └── vditemplate-crd.yaml
│   ├── configmap.yaml
│   ├── service.yaml
│   └── servicemonitor.yaml
└── charts/
    └── coturn/
```

**values.yaml:**
```yaml
operator:
  image:
    repository: ghcr.io/org/vdi-operator
    tag: v0.1.0
  replicas: 1

selkies:
  image: ghcr.io/selkies-project/

## Solution
{
  "session_id": "026909fd-0e52-48fd-bfff-b26e80d13872",
  "response": "Based on the `20260102_helm_chart` user story and the `docs/TDD.md`, I have designed the Helm chart components.\nThe `Chart.yaml` defines the chart identity. `values.yaml` exposes the required configuration knobs (operator image, selkies image, resources, ingress).\nThe CRDs are taken directly from the TDD schema definitions.\nThe `deployment.yaml` sets up the operator lifecycle, and `rbac.yaml` ensures it has permissions to manage VDI sessions, templates, and child resources (Pods, PVCs, Services, Traefik IngressRoutes).\nI've also included the `configmap.yaml` for GPU time-slicing and the observability components (`service.yaml`, `servicemonitor.yaml`).\nA placeholder `coturn` subchart definition is included to satisfy the directory structure requirement.\n\n```json\n{\n  \"reasoning\": \"Standard Helm chart structure implemented. CRDs embedded in templates/crds/ for management. RBAC configured for controller-runtime needs (Pods, Services, IngressRoutes). ConfigMap added for GPU time-slicing.\",\n  \"changes\": [\n    {\n      \"path\": \"charts/vdi-operator/Chart.yaml\",\n      \"content\": \"apiVersion: v2\\nname: vdi-operator\\ndescription: A Helm chart for the Kasm VDI Operator\\ntype: application\\nversion: 0.1.0\\nappVersion: \\\"0.1.0\\\"\\ndependencies:\\n  - name: coturn\\n    version: 0.1.0\\n    repository: \\\"file://charts/coturn\\\"\\n    condition: coturn.enabled\"\n    },\n    {\n      \"path\": \"charts/vdi-operator/values.yaml\",\n      \"content\": \"operator:\\n  image:\\n    repository: ghcr.io/org/vdi-operator\\n    tag: v0.1.0\\n    pullPolicy: IfNotPresent\\n  replicas: 1\\n  resources:\\n    limits:\\n      cpu: 500m\\n      memory: 128Mi\\n    requests:\\n      cpu: 10m\\n      memory: 64Mi\\n\\nselkies:\\n  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest\\n  defaultResources:\\n    gpu: 1\\n    memory: 4Gi\\n\\ningress:\\n  enabled: true\\n  className: traefik\\n  domain: vdi.example.com\\n  tls:\\n    enabled: true\\n    certResolver: letsencrypt\\n\\ngpu:\\n  timeSlicing:\\n    enabled: true\\n    replicas: 8\\n\\ncoturn:\\n  enabled: true\"\n    },\n    {\n      \"path\": \"charts/vdi-operator/templates/crds/vdisession-crd.yaml\",\n      \"content\": \"apiVersion: apiextensions.k8s.io/v1\\nkind: CustomResourceDefinition\\nmetadata:\\n  name: vdisessions.vdi.kasm.io\\nspec:\\n  group: vdi.kasm.io\\n  versions:\\n    - name: v1alpha1\\n      served: true\\n      storage: true\\n      schema:\\n        openAPIV3Schema:\\n          type: object\\n          properties:\\n            spec:\\n              type: object\\n              required: [user, template]\\n              properties:\\n                user:\\n                  type: string\\n                  description: User email or ID\\n                template:\\n                  type: string\\n                  description: Reference to VDITemplate\\n                resour

## Key Techniques
- JWT token handling
- Input validation
