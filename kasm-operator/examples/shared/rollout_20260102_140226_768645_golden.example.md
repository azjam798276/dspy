---
id: "rollout_20260102_140226_768645_golden"
generated_at: "2026-01-02T16:03:02.817899"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "92178397-eb18-4025-a9a2-3b240b218afe",
  "response": "Based on the `docs/TDD.md`, I need to define the `VDITemplate` CRD in Go. The specification requires a Cluster-scoped resource with fields for `image` (required), `displayName`, `description`, `resources` (with defaults), and `env` variables. I will define the `VDITemplateSpec` and auxiliary structs `TemplateResourceSpec` and `EnvVar` with appropriate `kubebuilder` markers for validation and defaults.\n\n```json\n{\n  \"reasoning\": \"I have designed the `VDITemplate` Go struct to match the CRD schema defined in `docs/TDD.md`. \\n\\n1.  **Scope**: Added `// +kubebuilder:resource:scope=Cluster` to `VDITemplate` struct to make it cluster-scoped as requested.\\n2.  **Fields**: \\n    *   `Image`: Added `// +kubebuilder:validation:Required` marker.\\n    *   `Resources`: Created `TemplateResourceSpec` struct to hold `DefaultGPU`, `DefaultMemory`, and `DefaultCPU` with their respective default values using `// +kubebuilder:default=...` markers.\\n    *   `Env`: Defined `EnvVar` struct for environment variables.\\n3.  **Registration**: Included `init()` function to register the types with `SchemeBuilder`.\",\n  \"changes\": [\n    {\n      \"path\": \"api/v1alpha1/vditemplate_types.go\",\n      \"content\": \"/*\\nCopyright 2026.\\n\\nLicensed under the Apache License, Version 2.0 (the \\\"License\\\");\\nyou may not use this file except in compliance with the License.\\nYou may obtain a copy of the License at\\n\\n    http://www.apache.org/licenses/LICENSE-2.0\\n\\nUnless required by applicable law or agreed to in writing, software\\ndistributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\nSee the License for the specific language governing permissions and\\nlimitations under the License.\\n*/\\n\\npackage v1alpha1\\n\\nimport (\\n\\tmetav1 \\\"k8s.io/apimachinery/pkg/apis/meta/v1\\\"\\n)\\n\\n// VDITemplateSpec defines the desired state of VDITemplate\\ntype VDITemplateSpec struct {\\n\\t// Image is the container image for the VDI session\\n\\t// +kubebuilder:validation:Required\\n\\tImage string `json:\\\"image\\\"`\\n\\n\\t// DisplayName is the human-readable name of the template\\n\\t// +optional\\n\\tDisplayName string `json:\\\"displayName,omitempty\\\"`\\n\\n\\t// Description provides details about the template\\n\\t// +optional\\n\\tDescription string `json:\\\"description,omitempty\\\"`\\n\\n\\t// Resources defines the default resource allocations\\n\\t// +optional\\n\\tResources TemplateResourceSpec `json:\\\"resources,omitempty\\\"`\\n\\n\\t// Env defines environment variables to inject\\n\\t// +optional\\n\\tEnv []EnvVar `json:\\\"env,omitempty\\\"`\\n}\\n\\n// TemplateResourceSpec defines default resources for the template\\ntype TemplateResourceSpec struct {\\n\\t// DefaultGPU is the number of GPUs to allocate\\n\\t// +kubebuilder:default=1\\n\\t// +optional\\n\\tDefaultGPU i

## Key Techniques
- JWT token handling
- Input validation
