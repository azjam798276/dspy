---
id: "rollout_20260102_155817_711174_golden"
generated_at: "2026-01-02T16:03:02.837033"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_coturn_deployment"
difficulty: "medium"
tags: ["webrtc", "turn", "stun", "nat", "coturn"]
tech_stack: "Coturn, Kubernetes, UDP, TLS"
---

# User Story
As a streaming engineer, I want a Coturn TURN server deployment, so WebRTC connections work through restrictive NATs and firewalls.

# Context & Constraints
**Deployment Configuration:**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: coturn
spec:
  template:
    spec:
      hostNetwork: true
      containers:
        - name: coturn
          image: coturn/coturn:latest
          args:
            - -n
            - --log-file=stdout
            - --external-ip=$(POD_IP)
            - --listening-port=3478
            - --min-port=49152
            - --max-port=65535
            - --realm=vdi.example.com
```


## Solution
{
  "session_id": "20c0ad26-4b30-4215-a791-545d9341e9ac",
  "response": "```json\n{\n  \"reasoning\": \"I will create a Kubernetes Deployment for Coturn using the specified `hostNetwork: true` configuration to ensure low-latency UDP handling and simplified NAT traversal. The deployment will include the required arguments for external IP mapping (`$(POD_IP)`), port ranges, and authentication realm. I will also create a corresponding `Service` (NodePort) to expose the signaling port (3478) and a `Secret` to store the TURN credentials securely. This setup satisfies the requirement for enabling WebRTC connectivity through restrictive firewalls.\",\n  \"code_patch\": \"apiVersion: v1\\nkind: Secret\\nmetadata:\\n  name: coturn-secret\\n  namespace: default\\ntype: Opaque\\nstringData:\\n  secret: \\\"change-me-in-production\\\"\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: coturn\\n  namespace: default\\nspec:\\n  type: NodePort\\n  selector:\\n    app: coturn\\n  ports:\\n    - name: signaling\\n      port: 3478\\n      targetPort: 3478\\n      protocol: TCP\\n    - name: signaling-udp\\n      port: 3478\\n      targetPort: 3478\\n      protocol: UDP\\n---\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: coturn\\n  namespace: default\\n  labels:\\n    app: coturn\\nspec:\\n  replicas: 1\\n  selector:\\n    matchLabels:\\n      app: coturn\\n  template:\\n    metadata:\\n      labels:\\n        app: coturn\\n    spec:\\n      hostNetwork: true\\n      containers:\\n        - name: coturn\\n          image: coturn/coturn:latest\\n          args:\\n            - -n\\n            - --log-file=stdout\\n            - --external-ip=$(POD_IP)\\n            - --listening-port=3478\\n            - --min-port=49152\\n            - --max-port=65535\\n            - --realm=vdi.example.com\\n            - --lt-cred-mech\\n            - --user=vdi:$(TURN_SECRET)\\n          env:\\n            - name: POD_IP\\n              valueFrom:\\n                fieldRef:\\n                  fieldPath: status.podIP\\n            - name: TURN_SECRET\\n              valueFrom:\\n                secretKeyRef:\\n                  name: coturn-secret\\n                  key: secret\"\n}\n```",
  "stats": {
    "models": {
      "gemini-2.5-flash-lite": {
        "api": {
          "totalRequests": 1,
          "totalErrors": 0,
          "totalLatencyMs": 2237
        },
        "tokens": {
          "input": 5963,
          "prompt": 5963,
          "candidates": 99,
          "total": 6428,
          "cached": 0,
          "thoughts": 366,
          "tool": 0
        }
      },
      "gemini-3-pro-preview": {
        "api": {
          "totalRequests": 6,
          "totalErrors": 0,
          "totalLatencyMs": 112208
        },
        "tokens": {
          "input": 76765,
          "prompt": 157159,
          "candidates": 1381,
          "total": 166280,
          "cached": 80394,
          "thoughts": 7740,
          "tool": 0
        }
      }
  

## Key Techniques
- JWT token handling
