---
id: "rollout_20260102_140558_591126_golden"
generated_at: "2026-01-02T16:03:02.804686"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_helm_chart"
difficulty: "hard"
tags: ["devops", "helm", "kubernetes", "deployment", "operator"]
tech_stack: "Helm 3, Kubernetes, Go"
---

# User Story
As a DevOps engineer, I want a Helm chart for the VDI Operator, so I can deploy and configure the platform with a single command.

# Context & Constraints
**Chart Structure:**
```
charts/vdi-operator/
├── Chart.yaml
├── values.yaml
├── templates/
│   ├── deployment.yaml
│   ├── rbac.yaml
│   ├── crds/
│   │   ├── vdisession-crd.yaml
│   │   └── vditemplate-crd.yaml
│   ├── configmap.yaml
│   ├── service.yaml
│   └── servicemonitor.yaml
└── charts/
    └── coturn/
```

**values.yaml:**
```yaml
operator:
  image:
    repository: ghcr.io/org/vdi-operator
    tag: v0.1.0
  replicas: 1

selkies:
  image: ghcr.io/selkies-project/

## Solution
{
  "session_id": "e061fabf-303c-4a6d-ac04-1e0ec2687043",
  "response": "```json\n{\n \"reasoning\": \"I have extracted the CRD definitions directly from `docs/TDD.md` to ensure the Helm chart aligns with the technical design. The chart structure follows standard Helm 3 practices. \\n\\nKey implementation details:\\n1.  **CRDs**: `VDISession` and `VDITemplate` are placed in `templates/crds/` to be managed by Helm. Using the schema defined in TDD.\\n2.  **Deployment**: Configured to run the operator controller. It uses the image and replica count from `values.yaml` as requested. It exposes port 8080 for metrics.\\n3.  **RBAC**: Created a ClusterRole and ClusterRoleBinding to allow the operator to manage core resources (Pods, Services, PVCs), Custom Resources (VDISession, VDITemplate), and Traefik IngressRoutes as specified in the TDD logic.\\n4.  **Service & Monitoring**: Added a Service exposing the metrics port and a ServiceMonitor (conditional on `serviceMonitor.enabled`) to allow Prometheus scraping, matching the TDD requirements.\\n5.  **Values**: Reflects the user story requirements, allowing configuration of the operator image, Selkies defaults, and Ingress domain.\",\n \"changes\": [\n  {\n   \"file\": \"charts/vdi-operator/Chart.yaml\",\n   \"content\": \"apiVersion: v2\\nname: vdi-operator\\ndescription: A Helm chart for the Kasm VDI Operator\\ntype: application\\nversion: 0.1.0\\nappVersion: \\\"0.1.0\\\"\"\n  },\n  {\n   \"file\": \"charts/vdi-operator/values.yaml\",\n   \"content\": \"operator:\\n  image:\\n    repository: ghcr.io/org/vdi-operator\\n    tag: v0.1.0\\n    pullPolicy: IfNotPresent\\n  replicas: 1\\n  resources:\\n    limits:\\n      cpu: 500m\\n      memory: 128Mi\\n    requests:\\n      cpu: 10m\\n      memory: 64Mi\\n\\nselkies:\\n  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest\\n  defaultResources:\\n    gpu: 1\\n    memory: 4Gi\\n\\ningress:\\n  enabled: true\\n  className: traefik\\n  domain: vdi.example.com\\n\\nserviceMonitor:\\n  enabled: true\"\n  },\n  {\n   \"file\": \"charts/vdi-operator/templates/crds/vdisession-crd.yaml\",\n   \"content\": \"apiVersion: apiextensions.k8s.io/v1\\nkind: CustomResourceDefinition\\nmetadata:\\n  name: vdisessions.vdi.kasm.io\\n  annotations:\\n    controller-gen.kubebuilder.io/version: v0.9.2\\nspec:\\n  group: vdi.kasm.io\\n  versions:\\n    - name: v1alpha1\\n      served: true\\n      storage: true\\n      schema:\\n        openAPIV3Schema:\\n          type: object\\n          properties:\\n            spec:\\n              type: object\\n              required: [user, template]\\n              properties:\\n                user:\\n                  type: string\\n                  description: User email or ID\\n                template:\\n                  type: string\\n                  description: Reference to VDITemplate\\n                resources:\\n                  type: object\\n                  properties:\\n                    gpu:\\n       

## Key Techniques
- JWT token handling
- Input validation
