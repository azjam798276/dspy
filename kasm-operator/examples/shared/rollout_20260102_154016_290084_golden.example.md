---
id: "rollout_20260102_154016_290084_golden"
generated_at: "2026-01-02T16:03:02.841451"
tags: ["shared", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "c0107a47-d55d-42a1-9e04-06cd5632d25f",
  "response": "Based on the `TDD.md` specifications, I have designed the `VDITemplate` CRD for the Kasm VDI Operator. The implementation includes the `VDITemplateSpec` with all required fields (`image`, `displayName`, `description`, `resources`, `env`), adhering to the `vdi.kasm.io/v1alpha1` GroupVersion.\n\nI've also included `groupversion_info.go` to ensure the package is a valid Kubebuilder API package. This code defines the `VDITemplate` struct with the necessary Kubebuilder markers (`+kubebuilder:resource:scope=Cluster`, `+kubebuilder:validation:Required`) to generate the cluster-scoped CRD.\n\n```json\n{\n  \"reasoning\": \"I have implemented the `VDITemplate` CRD in `operator/api/v1alpha1/vditemplate_types.go` following the specifications in `docs/TDD.md`. \\n\\nKey design decisions:\\n1.  **Scope**: Set to `Cluster` (`//+kubebuilder:resource:scope=Cluster`) as requested, since templates are shared across users.\\n2.  **Validation**: Added `//+kubebuilder:validation:Required` to the `Image` field.\\n3.  **Structs**: Defined `VDITemplateSpec`, `VDITemplateResources` (with default pointers/types as appropriate for optional fields, though the TDD specifies defaults in the CRD schema, Go structs usually use pointers or omitEmpty for optional fields. I matched the TDD schema types).\\n4.  **Package Info**: Included `operator/api/v1alpha1/groupversion_info.go` to correctly define the `vdi.kasm.io` group and `v1alpha1` version, which is prerequisite for the CRD generation to work.\",\n  \"code_patch\": \"diff --git a/operator/api/v1alpha1/groupversion_info.go b/operator/api/v1alpha1/groupversion_info.go\\nnew file mode 100644\\nindex 0000000..83e0056\\n--- /dev/null\\n+++ b/operator/api/v1alpha1/groupversion_info.go\\n@@ -0,0 +1,22 @@\\n+/*\\n+Copyright 2026.\\n+\\n+Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\\n+you may not use this file except in compliance with the License.\\n+You may obtain a copy of the License at\\n+\\n+    http://www.apache.org/licenses/LICENSE-2.0\\n+\\n+Unless required by applicable law or agreed to in writing, software\\n+distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n+See the License for the specific language governing permissions and\\n+limitations under the License.\\n+*/\\n+\\n+// Package v1alpha1 contains API Schema definitions for the vdi v1alpha1 API group\\n+// +kubebuilder:object:generate=true\\n+// +groupName=vdi.kasm.io\\n+package v1alpha1\\n+\\n+import (\\n+\\t\\\"k8s.io/apimachinery/pkg/runtime/schema\\\"\\n+\\t\\\"sigs.k8s.io/controller-runtime/pkg/scheme\\\"\\n+)\\n+\\n+var (\\n+\\t// GroupVersion is group version used to register these objects\\n+\\tGroupVersion = schema.GroupVersion{Group: \\\"vdi.kasm.io\\\", Version: \\\"v1alpha1\\\"}\\n+\\n+\\t// SchemeBuilder is used to add go types to the GroupVersionKind scheme\\n+

## Key Techniques
- JWT token handling
- Input validation
