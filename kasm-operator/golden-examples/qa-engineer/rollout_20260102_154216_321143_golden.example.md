---
id: "rollout_20260102_154216_321143_golden"
generated_at: "2026-01-02T16:10:46.054179"
tags: ["qa-engineer", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "d9007d7c-be78-49fd-bc91-a41552fd85d0",
  "response": "Based on the requirements, I have designed the Go structs for the `VDITemplate` CRD. The implementation follows the Kubebuilder patterns, using markers for validation, defaults, and scope definition.\n\n```json\n{\n  \"reasoning\": \"Implemented the VDITemplate CRD by defining the Go structs in `vditemplate_types.go` and the group info in `groupversion_info.go`. \\n\\nKey design decisions:\\n1.  **Cluster Scope:** Used `//+kubebuilder:resource:scope=Cluster` marker as requested, since templates should be available globally.\\n2.  **Validation:** Enforced `Image` as a required field using `//+kubebuilder:validation:Required`.\\n3.  **Defaults:** Applied `//+kubebuilder:default` markers to resource fields (GPU: 1, Memory: 4Gi, CPU: 2) to simplify usage.\\n4.  **Structure:** Separated `Resources` into `VDITemplateResourceSpec` and `Env` into `EnvVar` structs for clarity and reusability.\",\n  \"changes\": [\n    {\n      \"path\": \"operator/api/v1alpha1/groupversion_info.go\",\n      \"content\": \"/*\\nCopyright 2026.\\n\\nLicensed under the Apache License, Version 2.0 (the \\\"License\\\");\\nyou may not use this file except in compliance with the License.\\nYou may obtain a copy of the License at\\n\\n    http://www.apache.org/licenses/LICENSE-2.0\\n\\nUnless required by applicable law or agreed to in writing, software\\ndistributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\nSee the License for the specific language governing permissions and\\nlimitations under the License.\\n*/\\n\\n// Package v1alpha1 contains API Schema definitions for the vdi v1alpha1 API group\\n// +kubebuilder:object:generate=true\\n// +groupName=vdi.kasm.io\\npackage v1alpha1\\n\\nimport (\\n\\t\\\"k8s.io/apimachinery/pkg/runtime/schema\\\"\\n\\t\\\"sigs.k8s.io/controller-runtime/pkg/scheme\\\"\\n)\\n\\nvar (\\n\\t// GroupVersion is group version used to register these objects\\n\\tGroupVersion = schema.GroupVersion{Group: \\\"vdi.kasm.io\\\", Version: \\\"v1alpha1\\\"}\\n\\n\\t// SchemeBuilder is used to add go types to the GroupVersionKind scheme\\n\\tSchemeBuilder = &scheme.Builder{GroupVersion: GroupVersion}\\n\\n\\t// AddToScheme adds the types in this group-version to the given scheme.\\n\\tAddToScheme = SchemeBuilder.AddToScheme\\n)\\n\"\n    },\n    {\n      \"path\": \"operator/api/v1alpha1/vditemplate_types.go\",\n      \"content\": \"/*\\nCopyright 2026.\\n\\nLicensed under the Apache License, Version 2.0 (the \\\"License\\\");\\nyou may not use this file except in compliance with the License.\\nYou may obtain a copy of the License at\\n\\n    http://www.apache.org/licenses/LICENSE-2.0\\n\\nUnless required by applicable law or agreed to in writing, software\\ndistributed under the License is distributed on an \\\"AS IS\\\" BASIS,\\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or im

## Key Techniques
- JWT token handling
- Input validation
