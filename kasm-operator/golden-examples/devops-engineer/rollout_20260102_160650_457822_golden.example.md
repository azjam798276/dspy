---
id: "rollout_20260102_160650_457822_golden"
generated_at: "2026-01-02T17:04:39.592138"
tags: ["devops-engineer", "auto-generated"]
---

## Problem
---
id: "20260102_helm_chart"
difficulty: "hard"
tags: ["devops", "helm", "kubernetes", "deployment", "operator"]
tech_stack: "Helm 3, Kubernetes, Go"
---

# User Story
As a DevOps engineer, I want a Helm chart for the VDI Operator, so I can deploy and configure the platform with a single command.

# Context & Constraints
**Chart Structure:**
```
charts/vdi-operator/
├── Chart.yaml
├── values.yaml
├── templates/
│   ├── deployment.yaml
│   ├── rbac.yaml
│   ├── crds/
│   │   ├── vdisession-crd.yaml
│   │   └── vditemplate-crd.yaml
│   ├── configmap.yaml
│   ├── service.yaml
│   └── servicemonitor.yaml
└── charts/
    └── coturn/
```

**values.yaml:**
```yaml
operator:
  image:
    repository: ghcr.io/org/vdi-operator
    tag: v0.1.0
  replicas: 1

selkies:
  image: ghcr.io/selkies-project/

## Solution
{
  "session_id": "d7adba56-92c3-4621-8eda-f8c41d2960bf",
  "response": "```json\n{\n \"reasoning\": \"I have structured the Helm chart according to the user story and standard practices. \\n\\n1. **Structure**: Created the `charts/vdi-operator` directory with standard `templates/` and `charts/` subdirectories.\\n2. **CRDs**: Extracted `VDISession` and `VDITemplate` definitions directly from `docs/TDD.md` and placed them in `templates/crds/`.\\n3. **Values**: Configured `values.yaml` to match the user story's specific fields (`operator.image`, `selkies.image`, `ingress.domain`) and defaults.\\n4. **Deployment**: The `deployment.yaml` utilizes the values for image and replicas, and sets up the controller manager with necessary args/ports.\\n5. **RBAC**: Defined a `ClusterRole` that grants the operator permissions on `vdi.kasm.io` resources, as well as core resources (`pods`, `services`, `pvc`, `events`) and Traefik `ingressroutes`, which are required by the controller logic in the TDD.\\n6. **Monitoring**: Added `servicemonitor.yaml` and a Service for metrics, compliant with the TDD.\\n7. **GPU Config**: Included `configmap.yaml` for the GPU time-slicing configuration as specified in the TDD.\\n8. **Dependencies**: Defined a placeholder `coturn` dependency in `Chart.yaml` to match the requested directory structure.\",\n \"changes\": [\n  {\n   \"file\": \"charts/vdi-operator/Chart.yaml\",\n   \"content\": \"apiVersion: v2\\nname: vdi-operator\\ndescription: A Helm chart for the Kasm VDI Operator\\ntype: application\\nversion: 0.1.0\\nappVersion: \\\"0.1.0\\\"\\ndependencies:\\n  - name: coturn\\n    version: 0.1.0\\n    repository: \\\"file://charts/coturn\\\"\\n    condition: coturn.enabled\"\n  },\n  {\n   \"file\": \"charts/vdi-operator/values.yaml\",\n   \"content\": \"operator:\\n  image:\\n    repository: ghcr.io/org/vdi-operator\\n    tag: v0.1.0\\n    pullPolicy: IfNotPresent\\n  replicas: 1\\n  resources:\\n    limits:\\n      cpu: 500m\\n      memory: 128Mi\\n    requests:\\n      cpu: 10m\\n      memory: 64Mi\\n\\nselkies:\\n  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest\\n  defaultResources:\\n    gpu: 1\\n    memory: 4Gi\\n\\ningress:\\n  enabled: true\\n  className: traefik\\n  domain: vdi.example.com\\n  tls:\\n    enabled: true\\n    certResolver: letsencrypt\\n\\ngpu:\\n  timeSlicing:\\n    enabled: true\\n    replicas: 8\\n\\nserviceMonitor:\\n  enabled: true\\n\\ncoturn:\\n  enabled: true\"\n  },\n  {\n   \"file\": \"charts/vdi-operator/templates/crds/vdisession-crd.yaml\",\n   \"content\": \"apiVersion: apiextensions.k8s.io/v1\\nkind: CustomResourceDefinition\\nmetadata:\\n  name: vdisessions.vdi.kasm.io\\n  annotations:\\n    controller-gen.kubebuilder.io/version: v0.9.2\\nspec:\\n  group: vdi.kasm.io\\n  versions:\\n    - name: v1alpha1\\n      served: true\\n      storage: true\\n      schema:\\n        openAPIV3Schema:\\n          type: object\\n          properties:\\n            spec:\\n              ty

## Key Techniques
- JWT token handling
- Input validation
