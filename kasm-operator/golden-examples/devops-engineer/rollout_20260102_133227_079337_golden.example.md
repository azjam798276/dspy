---
id: "rollout_20260102_133227_079337_golden"
generated_at: "2026-01-02T17:04:39.594687"
tags: ["devops-engineer", "auto-generated"]
---

## Problem
---
id: "20260102_vditemplate_crd"
difficulty: "easy"
tags: ["kubernetes", "crd", "template", "kubebuilder"]
tech_stack: "Go 1.21, kubebuilder"
---

# User Story
As a platform admin, I want a VDITemplate CRD to define available desktop environments, so users can choose from pre-configured templates.

# Context & Constraints
**CRD Specification:**
```yaml
apiVersion: vdi.kasm.io/v1alpha1
kind: VDITemplate
metadata:
  name: ubuntu-desktop
spec:
  image: ghcr.io/selkies-project/selkies-gstreamer/gst-web:latest
  displayName: "Ubuntu 22.04 Desktop"
  description: "Full Ubuntu desktop with GPU acceleration"
  resources:
    defaultGPU: 1
    defaultMemory: "4Gi"
    defaultCPU: "2"
  env:
    - name: SELKIES_ENCODER
      value: "nvh264enc"
```

**Fields:**
| Field | Type | Description |
|-----

## Solution
{
  "session_id": "9280adfe-126f-43f8-bdf7-c98377696c21",
  "response": "```json\n{\n  \"session_id\": \"9f3c1a2b-4d5e-6f7g-8h9i-0j1k2l3m4n5o\",\n  \"response\": \"I will create the `VDITemplate` CRD definition in Go using Kubebuilder markers. \\n\\n**Reasoning:**\\n1.  **Scope**: The User Story specifies this is a \\\"Cluster-scoped resource\\\" because templates (like \\\"Ubuntu Desktop\\\") should be available globally to all users, not restricted to a namespace. I will use `+kubebuilder:resource:scope=Cluster`.\\n2.  **Schema**: I will map the `spec` fields directly to a Go struct `VDITemplateSpec`. \\n    *   `Image`: Marked `+kubebuilder:validation:Required` as it's the core of the template.\\n    *   `Resources`: I will define a nested struct `TemplateResources` to hold the default GPU/CPU/Memory values. Using `string` for Memory/CPU ensures compatibility with K8s quantity formats (e.g., \\\"4Gi\\\") without complex parsing logic at the API level.\\n    *   `Env`: I will reuse `corev1.EnvVar` to allow standard environment variable definitions (name/value/valueFrom), which is idiomatic for K8s operators.\\n3.  **Observability**: I will add `+kubebuilder:printcolumn` markers to ensure `kubectl get vditemplates` shows useful info like the Image and creation date, adhering to the persona's guidelines for observability.\\n4.  **Subresources**: Enabled `/status` as mandated by the `k8s-operator-developer` persona.\",\n  \"code_changes\": {\n    \"operator/api/v1alpha1/vditemplate_types.go\": \"package v1alpha1\\n\\nimport (\\n\\tcorev1 \\\"k8s.io/api/core/v1\\\"\\n\\tmetav1 \\\"k8s.io/apimachinery/pkg/apis/meta/v1\\\"\\n)\\n\\n// TemplateResources defines the default resource requirements for a VDI session\\ntype TemplateResources struct {\\n\\t// DefaultGPU is the number of GPU slices/units to allocate\\n\\t// +optional\\n\\tDefaultGPU int `json:\\\"defaultGPU,omitempty\\\"`\\n\\n\\t// DefaultMemory is the default RAM allocation (e.g., \\\"4Gi\\\")\\n\\t// +optional\\n\\tDefaultMemory string `json:\\\"defaultMemory,omitempty\\\"`\\n\\n\\t// DefaultCPU is the default CPU allocation (e.g., \\\"2\\\")\\n\\t// +optional\\n\\tDefaultCPU string `json:\\\"defaultCPU,omitempty\\\"`\\n}\\n\\n// VDITemplateSpec defines the desired state of VDITemplate\\ntype VDITemplateSpec struct {\\n\\t// Image is the container image for the VDI session\\n\\t// +kubebuilder:validation:Required\\n\\tImage string `json:\\\"image\\\"`\\n\\n\\t// DisplayName is the human-readable name shown in the UI\\n\\t// +optional\\n\\tDisplayName string `json:\\\"displayName,omitempty\\\"`\\n\\n\\t// Description provides details about the template's contents\\n\\t// +optional\\n\\tDescription string `json:\\\"description,omitempty\\\"`\\n\\n\\t// Resources defines the default compute resources\\n\\t// +optional\\n\\tResources TemplateResources `json:\\\"resources,omitempty\\\"`\\n\\n\\t// Env defines environment variables to inject into the session\\n\\t// +optional\\n\\tEnv []corev1.

## Key Techniques
- JWT token handling
- Input validation
